# 1A2B 猜數字遊戲 - 軟體規格書

## 版本資訊

| 項目 | 內容 |
|------|------|
| 專案名稱 | 1A2B 猜數字遊戲 (1A2B CLI Game) |
| 版本號碼 | v0.1.0 |
| 文件版本 | 1.0 |
| 最後更新 | 2025-11-25 |
| 專案類型 | 命令列互動遊戲 |
| 程式語言 | Python 3.13 |

---

## 1. 專案概述

### 1.1 專案簡介

本專案是一款經典的 1A2B（又稱 Bulls and Cows）猜數字遊戲的命令列實作版本。玩家需要在有限次數內猜出電腦隨機產生的 4 位不重複數字，系統會根據每次猜測提供線索（A 和 B），協助玩家逐步推理出正確答案。

### 1.2 專案目標

- 提供流暢且直觀的命令列遊戲體驗
- 實現經典 1A2B 遊戲的完整規則
- 使用彩色輸出和優雅的介面設計提升使用體驗
- 確保輸入驗證和錯誤處理的完整性
- 支援多局連續遊玩

### 1.3 目標使用者

- 喜愛邏輯推理遊戲的玩家
- 尋找休閒益智遊戲的使用者
- Python 學習者（可作為範例專案）
- 命令列介面愛好者

---

## 2. 功能需求規格

### 2.1 核心功能

#### 2.1.1 隨機答案產生
- **功能編號**: F-001
- **優先級**: 高
- **描述**: 系統須在每局遊戲開始時產生一個 4 位數字作為答案
- **規則**:
  - 數字範圍：0-9
  - 長度：固定 4 位
  - 約束：四個數字不可重複
  - 每局遊戲答案須隨機產生

#### 2.1.2 使用者猜測輸入
- **功能編號**: F-002
- **優先級**: 高
- **描述**: 接收並驗證使用者的猜測輸入
- **輸入規則**:
  - 必須為 4 位數字
  - 數字不可重複
  - 僅接受數字字元（0-9）
- **驗證機制**:
  - 長度檢查
  - 字元類型檢查
  - 重複性檢查
- **錯誤處理**: 輸入不符合規則時，顯示提示訊息並要求重新輸入

#### 2.1.3 猜測結果判定
- **功能編號**: F-003
- **優先級**: 高
- **描述**: 比對使用者猜測與正確答案，計算 A 和 B 的數量
- **判定邏輯**:
  - **A (完全正確)**：數字相同且位置相同
  - **B (部分正確)**：數字相同但位置不同
  - 每個數字僅計算一次（不重複計算）
- **輸出格式**: `XA YB`（X 為 A 的數量，Y 為 B 的數量）

#### 2.1.4 遊戲流程控制
- **功能編號**: F-004
- **優先級**: 高
- **描述**: 管理遊戲的整體流程
- **遊戲參數**:
  - 最大猜測次數：10 次
  - 勝利條件：4A0B（所有數字位置都正確）
  - 失敗條件：用完所有猜測次數
- **流程控制**:
  1. 顯示歡迎訊息和遊戲規則
  2. 開始猜測循環（最多 10 次）
  3. 每次猜測後顯示結果
  4. 判定勝負並顯示相應訊息
  5. 詢問是否重新開始

### 2.2 使用者介面功能

#### 2.2.1 彩色輸出
- **功能編號**: F-005
- **優先級**: 中
- **描述**: 使用 ANSI 顏色代碼美化輸出
- **顏色規範**:
  - 綠色 (`\033[92m`): 顯示 A 的數量
  - 黃色 (`\033[93m`): 顯示 B 的數量
  - 重置 (`\033[0m`): 恢復預設顏色

#### 2.2.2 同行顯示結果
- **功能編號**: F-006
- **優先級**: 中
- **描述**: 猜測結果與輸入顯示在同一行
- **實現方式**:
  - 使用 ANSI 控制碼 `\033[A` 向上移動游標
  - 使用 `\r` 回到行首
  - 重新輸出完整的猜測與結果

#### 2.2.3 視覺裝飾元素
- **功能編號**: F-007
- **優先級**: 低
- **描述**: 提供美觀的遊戲介面
- **元素**:
  - 遊戲標題框（使用 Unicode 框線字元）
  - 分隔線（使用 `=` 和 `─`）
  - 表情符號（勝利 🎉、失敗 😢、再見 👋）

### 2.3 輔助功能

#### 2.3.1 重玩功能
- **功能編號**: F-008
- **優先級**: 高
- **描述**: 遊戲結束後允許使用者選擇重新開始
- **輸入選項**: Y/N (不區分大小寫，支援完整單字 YES/NO)
- **行為**:
  - Y/YES: 開始新一局
  - N/NO: 結束程式

#### 2.3.2 中斷處理
- **功能編號**: F-009
- **優先級**: 中
- **描述**: 優雅處理鍵盤中斷（Ctrl+C）
- **行為**:
  - 捕獲 `KeyboardInterrupt` 異常
  - 顯示告別訊息
  - 正常退出程式（exit code 0）

---

## 3. 技術規格

### 3.1 開發環境

| 項目 | 規格 |
|------|------|
| 程式語言 | Python 3.13+ |
| 套件管理工具 | uv |
| 最低 Python 版本 | 3.13 |
| 相依套件 | 無（僅使用標準庫） |
| 作業系統支援 | Windows, macOS, Linux |

### 3.2 標準庫使用

本專案僅使用 Python 標準庫，不需要額外安裝第三方套件：

- **random**: 隨機數產生
- **sys**: 系統相關功能（標準輸出控制、程式退出）

### 3.3 相容性需求

- **終端機支援**: 需要支援 ANSI 轉義序列的終端機
- **字元編碼**: UTF-8（用於顯示中文和 Emoji）
- **顯示寬度**: 建議至少 50 字元寬度

---

## 4. 系統架構

### 4.1 架構概述

本專案採用**模組化單一檔案設計**，將遊戲邏輯分為獨立的函式模組，便於維護和測試。

```
┌─────────────────────────────────────┐
│         main() 主程式入口           │
│    (遊戲循環與使用者互動控制)        │
└───────────────┬─────────────────────┘
                │
                ▼
┌─────────────────────────────────────┐
│        play_game() 單局遊戲         │
│     (猜測循環與結果顯示)             │
└───────┬─────────────────────────────┘
        │
        ├──► generate_answer()      (答案產生)
        ├──► is_valid_guess()       (輸入驗證)
        └──► check_guess()          (結果判定)
```

### 4.2 模組設計原則

- **單一職責**: 每個函式負責單一明確的功能
- **低耦合**: 函式間保持獨立，減少相依性
- **高內聚**: 相關邏輯集中在同一函式內
- **可測試性**: 核心邏輯函式設計為純函式，便於單元測試

---

## 5. 模組說明

### 5.1 generate_answer()

**功能**: 產生遊戲答案

```python
def generate_answer() -> str
```

| 項目 | 內容 |
|------|------|
| **輸入** | 無 |
| **輸出** | 字串，包含 4 個不重複的數字字元 |
| **演算法** | 使用 `random.sample()` 從 0-9 隨機取 4 個不重複數字 |
| **時間複雜度** | O(1) |
| **空間複雜度** | O(1) |

**範例輸出**: `"1234"`, `"5678"`, `"0912"`

---

### 5.2 check_guess()

**功能**: 檢查猜測結果並計算 A 和 B 的數量

```python
def check_guess(answer: str, guess: str) -> tuple[int, int]
```

| 項目 | 內容 |
|------|------|
| **輸入** | `answer` (正確答案), `guess` (玩家猜測) |
| **輸出** | 元組 `(a_count, b_count)` |
| **演算法** | 雙重檢查：先比對位置相同，再比對數字存在 |
| **時間複雜度** | O(n²) where n=4，實際為 O(16) = O(1) |
| **空間複雜度** | O(1) |

**邏輯流程**:
1. 初始化 `a_count = 0`, `b_count = 0`
2. 遍歷每個位置 (i = 0 到 3):
   - 如果 `guess[i] == answer[i]`: `a_count += 1`
   - 否則如果 `guess[i] in answer`: `b_count += 1`
3. 返回 `(a_count, b_count)`

**範例**:
- `check_guess("1234", "1567")` → `(1, 0)` (1 位於相同位置)
- `check_guess("1234", "4321")` → `(0, 4)` (所有數字都在但位置錯誤)
- `check_guess("1234", "1243")` → `(2, 2)` (1和2位置正確，3和4位置錯誤)

---

### 5.3 is_valid_guess()

**功能**: 驗證輸入是否符合遊戲規則

```python
def is_valid_guess(guess: str) -> bool
```

| 項目 | 內容 |
|------|------|
| **輸入** | `guess` (玩家輸入的字串) |
| **輸出** | 布林值，True 表示有效，False 表示無效 |
| **驗證項目** | 長度、字元類型、重複性 |
| **時間複雜度** | O(n) where n=4 |
| **空間複雜度** | O(n) |

**驗證規則**:
1. **長度檢查**: `len(guess) == 4`
2. **數字檢查**: `guess.isdigit()`
3. **重複檢查**: `len(set(guess)) == 4`

**範例**:
- `is_valid_guess("1234")` → `True`
- `is_valid_guess("123")` → `False` (長度不足)
- `is_valid_guess("12ab")` → `False` (包含非數字)
- `is_valid_guess("1123")` → `False` (有重複數字)

---

### 5.4 play_game()

**功能**: 執行單局遊戲

```python
def play_game() -> bool
```

| 項目 | 內容 |
|------|------|
| **輸入** | 無 |
| **輸出** | 布林值，True 表示玩家獲勝，False 表示失敗 |
| **職責** | 遊戲循環、輸入輸出、結果判定 |
| **最大猜測次數** | 10 |

**流程**:
1. 產生答案 (`generate_answer()`)
2. 顯示遊戲說明和規則
3. 進入猜測循環 (最多 10 次):
   - 提示玩家輸入猜測
   - 驗證輸入 (`is_valid_guess()`)
   - 檢查結果 (`check_guess()`)
   - 顯示結果（彩色輸出）
   - 如果 4A0B，顯示勝利訊息並返回 True
4. 如果用完次數，顯示失敗訊息並返回 False

**輸出格式**:
```
第 1 次猜測：1234  →  1A2B
第 2 次猜測：1567  →  2A0B
```

**特殊處理**:
- 使用 `sys.stdout.write()` 和 ANSI 控制碼實現同行顯示
- 綠色顯示 A，黃色顯示 B

---

### 5.5 main()

**功能**: 程式主入口

```python
def main() -> None
```

| 項目 | 內容 |
|------|------|
| **輸入** | 無 |
| **輸出** | 無 |
| **職責** | 顯示標題、多局遊戲控制、重玩詢問 |

**流程**:
1. 顯示遊戲標題（美化框線）
2. 進入遊戲循環:
   - 執行一局遊戲 (`play_game()`)
   - 詢問是否重玩
   - 如果選擇 N/NO，結束程式
   - 如果選擇 Y/YES，顯示分隔線並繼續

**重玩邏輯**:
- 接受輸入: Y, N, YES, NO（不區分大小寫）
- 輸入無效時提示重新輸入

---

## 6. 資料結構

### 6.1 核心資料類型

| 變數名稱 | 類型 | 說明 | 範例 |
|---------|------|------|------|
| `answer` | str | 正確答案（4位不重複數字） | `"1234"` |
| `guess` | str | 玩家猜測（4位不重複數字） | `"5678"` |
| `a_count` | int | A 的數量（0-4） | `2` |
| `b_count` | int | B 的數量（0-4） | `1` |
| `attempts` | int | 當前猜測次數（1-10） | `5` |
| `max_attempts` | int | 最大猜測次數（固定為 10） | `10` |

### 6.2 常量定義

雖然程式中未明確定義常量，但以下值在程式邏輯中被視為常量：

```python
MAX_ATTEMPTS = 10        # 最大猜測次數
DIGIT_LENGTH = 4         # 答案長度
DIGIT_RANGE = range(10)  # 數字範圍 0-9
```

---

## 7. 使用者介面

### 7.1 歡迎畫面

```
╔════════════════════════════════════════════════╗
║               1A2B 猜數字遊戲                  ║
╚════════════════════════════════════════════════╝
```

### 7.2 遊戲說明

```
==================================================
歡迎來到 1A2B 猜數字遊戲！
規則：猜一個4位數字（數字不重複）
A = 數字和位置都正確
B = 數字正確但位置錯誤
你有 10 次機會
==================================================
```

### 7.3 猜測輸入與結果顯示

**輸入提示**:
```
第 1 次猜測：
```

**結果顯示** (同行):
```
第 1 次猜測：1234  →  1A2B
```
（其中 A 為綠色，B 為黃色）

**錯誤輸入提示**:
```
第 1 次猜測：123
             → 請輸入4個不重複的數字！
```

### 7.4 遊戲結束訊息

**勝利訊息**:
```
🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉
恭喜你！答案就是 1234
你總共猜了 5 次
🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉🎉
```

**失敗訊息**:
```
😢😢😢😢😢😢😢😢😢😢😢😢😢😢😢😢😢😢😢😢
很遺憾，你已經用完所有 10 次機會
正確答案是：1234
😢😢😢😢😢😢😢😢😢😢😢😢😢😢😢😢😢😢😢😢
```

### 7.5 重玩詢問

```
是否要再玩一局？(Y/N): 
```

**告別訊息**:
```
謝謝遊玩！再見！👋
```

### 7.6 中斷訊息

當使用者按下 Ctrl+C 時:
```
遊戲已中斷。再見！👋
```

---

## 8. 使用者操作流程

```
開始
  │
  ▼
顯示標題與說明
  │
  ▼
產生隨機答案
  │
  ▼
┌──────────────────┐
│ 輸入猜測         │◄───┐
└────┬─────────────┘    │
     │                   │
     ▼                   │
  驗證輸入               │
     │                   │
     ├─無效──► 顯示錯誤──┘
     │
     ▼ 有效
  計算 A 和 B
     │
     ▼
  顯示結果
     │
     ├─4A──► 顯示勝利訊息
     │             │
     ▼             │
  次數 < 10?       │
     │             │
     ├─是──────────┘
     │
     ▼ 否
顯示失敗訊息
     │
     ▼
  是否重玩?
     │
     ├─是──► 顯示分隔線──┐
     │                   │
     ▼ 否                │
  顯示告別訊息          │
     │                   │
     ▼                   │
   結束 ◄───────────────┘
```

---

## 9. 執行方式

### 9.1 使用 uv 執行（推薦）

```bash
uv run python 1a2b.py
```

**優點**:
- 自動管理 Python 版本
- 自動建立虛擬環境
- 確保環境一致性

### 9.2 直接執行

```bash
python 1a2b.py
```

**需求**:
- 已安裝 Python 3.13 或更高版本

### 9.3 套件安裝命令

本專案使用 uv 作為套件管理工具：

```bash
# 安裝 uv (若尚未安裝)
curl -LsSf https://astral.sh/uv/install.sh | sh

# 同步專案依賴
uv sync
```

---

## 10. 測試需求

### 10.1 單元測試範圍

雖然目前專案未包含測試程式碼，但建議對以下函式進行單元測試：

#### 10.1.1 generate_answer() 測試

| 測試案例 | 驗證項目 | 預期結果 |
|---------|---------|---------|
| TC-001 | 輸出長度 | 必須為 4 |
| TC-002 | 字元類型 | 必須都是數字 |
| TC-003 | 唯一性 | 四個數字不重複 |
| TC-004 | 隨機性 | 多次呼叫產生不同結果 |

#### 10.1.2 check_guess() 測試

| 測試案例 | answer | guess | 預期輸出 |
|---------|--------|-------|---------|
| TC-101 | "1234" | "1234" | (4, 0) |
| TC-102 | "1234" | "4321" | (0, 4) |
| TC-103 | "1234" | "1243" | (2, 2) |
| TC-104 | "1234" | "5678" | (0, 0) |
| TC-105 | "1234" | "1567" | (1, 0) |
| TC-106 | "0123" | "3210" | (0, 4) |

#### 10.1.3 is_valid_guess() 測試

| 測試案例 | 輸入 | 預期輸出 | 失敗原因 |
|---------|-----|---------|---------|
| TC-201 | "1234" | True | - |
| TC-202 | "0987" | True | - |
| TC-203 | "123" | False | 長度不足 |
| TC-204 | "12345" | False | 長度超過 |
| TC-205 | "12ab" | False | 包含非數字 |
| TC-206 | "1123" | False | 有重複數字 |
| TC-207 | "1111" | False | 所有數字相同 |
| TC-208 | "" | False | 空字串 |

### 10.2 整合測試

| 測試案例 | 測試目標 | 測試步驟 |
|---------|---------|---------|
| IT-001 | 完整遊戲流程 | 從開始到猜對的完整流程 |
| IT-002 | 失敗場景 | 猜測 10 次後仍未猜對 |
| IT-003 | 重玩功能 | 完成一局後選擇重玩 |
| IT-004 | 退出功能 | 完成一局後選擇退出 |
| IT-005 | 中斷處理 | 遊戲進行中按 Ctrl+C |

### 10.3 使用者體驗測試

| 測試項目 | 驗證內容 |
|---------|---------|
| 顏色顯示 | A 顯示為綠色，B 顯示為黃色 |
| 同行顯示 | 猜測與結果顯示在同一行 |
| 錯誤提示 | 輸入無效時顯示清晰的錯誤訊息 |
| 視覺美觀 | 框線和分隔線正確顯示 |
| 表情符號 | Emoji 正確顯示 |

---

## 11. 錯誤處理

### 11.1 輸入錯誤

| 錯誤類型 | 處理方式 | 使用者提示 |
|---------|---------|-----------|
| 長度不符 | 要求重新輸入 | "請輸入4個不重複的數字！" |
| 非數字字元 | 要求重新輸入 | "請輸入4個不重複的數字！" |
| 數字重複 | 要求重新輸入 | "請輸入4個不重複的數字！" |

### 11.2 系統錯誤

| 錯誤類型 | 處理方式 |
|---------|---------|
| KeyboardInterrupt | 捕獲並優雅退出，顯示告別訊息 |
| 其他異常 | 程式中止，錯誤訊息由 Python 預設處理 |

---

## 12. 效能規格

| 項目 | 規格 |
|------|------|
| 啟動時間 | < 1 秒 |
| 回應時間 | 輸入後即時顯示結果（< 50ms） |
| 記憶體使用 | < 10 MB |
| CPU 使用率 | 閒置時 < 1% |

---

## 13. 專案檔案結構

```
1A2B_cli/
├── 1a2b.py              # 遊戲主程式（210 行）
├── pyproject.toml       # 專案配置檔（uv 格式）
├── uv.lock              # 依賴鎖定檔
├── README.md            # 專案說明文件
└── __pycache__/         # Python 編譯快取（自動生成）
```

### 13.1 檔案說明

#### 1a2b.py
- **大小**: 約 3.5 KB
- **行數**: 124 行
- **編碼**: UTF-8
- **內容**: 所有遊戲邏輯和使用者介面

#### pyproject.toml
- **格式**: TOML
- **內容**: 專案元資料、依賴宣告、指令定義
- **套件管理工具**: uv

#### uv.lock
- **格式**: 自訂格式（uv）
- **內容**: 依賴版本鎖定（雖然本專案無外部依賴）

#### README.md
- **格式**: Markdown
- **內容**: 使用說明、遊戲規則、執行方式

---

## 14. 擴展性考量

### 14.1 可能的功能擴展

| 功能 | 描述 | 優先級 |
|------|------|--------|
| 難度選擇 | 支援 3位、5位、6位等不同長度 | 中 |
| 計時功能 | 記錄每局遊戲時間 | 低 |
| 排行榜 | 記錄最少猜測次數 | 低 |
| 提示系統 | 提供付費提示（排除錯誤答案） | 低 |
| 多人模式 | 雙人對戰或協作模式 | 低 |
| 歷史記錄 | 顯示之前的猜測和結果 | 中 |
| AI 助手 | 提供最佳猜測建議 | 低 |

### 14.2 程式碼重構建議

1. **配置外部化**: 將遊戲參數（最大次數、數字長度）移至配置檔
2. **測試程式碼**: 加入完整的單元測試和整合測試
3. **日誌系統**: 加入 logging 模組記錄遊戲過程
4. **類別化設計**: 考慮使用 OOP 設計，建立 Game 類別
5. **國際化**: 支援多語言介面（i18n）

### 14.3 效能優化建議

當前效能已足夠，但若要處理大量遊戲記錄或複雜功能時：

1. 使用資料庫儲存遊戲歷史
2. 使用 asyncio 處理 I/O 密集操作
3. 快取常用計算結果

---

## 15. 相容性與限制

### 15.1 系統需求

| 項目 | 最低需求 | 建議配置 |
|------|---------|---------|
| Python 版本 | 3.13 | 3.13+ |
| 作業系統 | Windows 10 / macOS 10.14 / Linux (kernel 4.0+) | 最新版本 |
| 終端機 | 支援 ANSI 轉義序列 | 支援 256 色 |
| 字元編碼 | UTF-8 | UTF-8 |

### 15.2 已知限制

1. **終端機相容性**: 
   - 某些舊版 Windows 命令提示字元可能無法正確顯示 ANSI 顏色
   - 建議使用 Windows Terminal、PowerShell 或 Git Bash

2. **表情符號支援**:
   - 部分終端機可能無法正確顯示 Emoji
   - 不影響核心遊戲功能

3. **螢幕寬度**:
   - 需要至少 50 字元寬度才能正確顯示介面
   - 小螢幕可能出現換行問題

4. **輸入法**:
   - 僅支援半形數字輸入
   - 全形數字會被視為無效輸入

---

## 16. 安全性考量

### 16.1 輸入驗證

- ✅ 所有使用者輸入經過嚴格驗證
- ✅ 無 SQL 注入風險（未使用資料庫）
- ✅ 無命令注入風險（未執行外部命令）
- ✅ 無路徑遍歷風險（未進行檔案操作）

### 16.2 隨機性

- 使用 Python 內建的 `random` 模組
- 適用於遊戲用途，但不適合密碼學應用
- 如需加密級隨機數，建議使用 `secrets` 模組

---

## 17. 維護與支援

### 17.1 版本更新計畫

| 版本 | 預計功能 | 狀態 |
|------|---------|------|
| v0.1.0 | 基礎遊戲功能 | ✅ 已完成 |
| v0.2.0 | 加入單元測試 | 📋 規劃中 |
| v0.3.0 | 難度選擇功能 | 📋 規劃中 |
| v1.0.0 | 正式版本 | 🔮 未來 |

### 17.2 問題回報

建議建立 GitHub Issues 追蹤系統來管理：
- Bug 回報
- 功能建議
- 文件改進

---

## 18. 授權與版權

| 項目 | 內容 |
|------|------|
| 開發者 | (待補充) |
| 授權方式 | (待補充，建議 MIT License) |
| 版權年份 | 2025 |

---

## 19. 參考資料

### 19.1 遊戲規則來源

- 1A2B（Bulls and Cows）是一款經典的紙筆遊戲
- 也被稱為「猜數字」、「Mastermind」（數字版本）

### 19.2 技術參考

- [Python 官方文件](https://docs.python.org/3.13/)
- [uv 套件管理工具](https://github.com/astral-sh/uv)
- [ANSI 轉義序列](https://en.wikipedia.org/wiki/ANSI_escape_code)

---

## 20. 附錄

### 附錄 A: ANSI 顏色代碼表

| 顏色 | 代碼 | 本專案使用 |
|------|------|-----------|
| 綠色 | `\033[92m` | ✅ A 的數量 |
| 黃色 | `\033[93m` | ✅ B 的數量 |
| 重置 | `\033[0m` | ✅ 恢復預設 |

### 附錄 B: 遊戲策略建議

**最佳開局猜測策略**:
1. 第一猜：使用 `0123` 或 `1234`（涵蓋範圍大）
2. 根據結果縮小範圍
3. 使用排除法逐步確定每個位置的數字

**常見玩家錯誤**:
- 忽略 B 的資訊（只關注 A）
- 重複猜測已排除的數字
- 未系統化地測試假設

---

## 文件版本控制

| 版本 | 日期 | 修改者 | 修改內容 |
|------|------|-------|---------|
| 1.0 | 2025-11-25 | AI Assistant | 初始版本建立 |

---

**文件結束**

