# 1A2B 猜數字遊戲 - 系統規格書

## 文件資訊

| 項目 | 內容 |
|------|------|
| 專案名稱 | 1A2B 猜數字遊戲 CLI |
| 版本 | 1.0.0 |
| 文件版本 | 1.0 |
| 最後更新日期 | 2025-11-27 |
| 作者 | 1A2B Development Team |

---

## 1. 專案概述

### 1.1 專案簡介

1A2B 猜數字遊戲（又稱 Bulls and Cows）是一款經典的邏輯推理遊戲。本專案以命令列介面（CLI）實作，提供友善的使用者體驗與完整的遊戲功能。

### 1.2 遊戲玩法

- 電腦隨機產生一個 4 位數字的答案，每個數字皆不重複（0-9）
- 玩家輸入 4 位數字進行猜測
- 系統回饋結果：
  - **A**：數字和位置都正確的數量
  - **B**：數字正確但位置錯誤的數量
- 玩家根據回饋繼續猜測，直到猜對或用完機會
- 每局遊戲最多可猜測 10 次

### 1.3 專案目標

- 提供流暢的文字模式遊戲體驗
- 實作完整的輸入驗證機制
- 設計直覺的使用者介面
- 支援遊戲中斷與重新開始功能

---

## 2. 系統需求

### 2.1 執行環境

| 項目 | 規格 |
|------|------|
| Python 版本 | ≥ 3.13 |
| 作業系統 | Windows / macOS / Linux |
| 終端機要求 | 支援 ANSI 顏色代碼 |
| 相依套件 | 無（僅使用標準函式庫）|

### 2.2 開發環境

| 工具 | 版本 | 用途 |
|------|------|------|
| uv | 最新版 | Python 環境管理 |
| Python | 3.13+ | 執行環境 |

---

## 3. 功能規格

### 3.1 核心功能

#### F-001：產生隨機答案
- **功能描述**：系統產生 4 位不重複的隨機數字作為答案
- **輸入**：無
- **輸出**：一個長度為 4 的字串，每個字元為 0-9 的數字且不重複
- **實作函式**：`generate_secret_number()`

#### F-002：計算猜測結果
- **功能描述**：比對玩家的猜測與答案，計算 A 和 B 的數量
- **輸入**：
  - `secret`：正確答案（字串）
  - `guess`：玩家猜測（字串）
- **輸出**：`(a_count, b_count)` 元組
- **實作函式**：`calculate_result(secret, guess)`
- **演算法**：
  1. 逐位比對，位置和數字都相符則 A+1
  2. 數字存在於答案中但位置不同則 B+1

#### F-003：輸入驗證
- **功能描述**：驗證玩家輸入是否符合規則
- **驗證規則**：
  - 必須恰好 4 個字元
  - 只能包含數字（0-9）
  - 4 個數字不可重複
- **輸入**：`guess`（字串）
- **輸出**：`(valid, error_msg)` 元組
- **實作函式**：`validate_input(guess)`

#### F-004：遊戲流程控制
- **功能描述**：控制單局遊戲的完整流程
- **流程**：
  1. 產生隨機答案
  2. 顯示遊戲規則
  3. 進入猜測迴圈（最多 10 次）
  4. 每次猜測進行輸入驗證
  5. 顯示猜測結果
  6. 判斷是否猜對或用完機會
  7. 顯示遊戲結果
- **實作函式**：`play_game()`

#### F-005：主程式控制
- **功能描述**：控制整體程式流程，支援多局遊戲
- **流程**：
  1. 顯示遊戲標題
  2. 執行單局遊戲
  3. 詢問是否再玩一次
  4. 根據玩家選擇決定繼續或結束
- **實作函式**：`main()`

### 3.2 輔助功能

#### F-101：顏色輸出
- **功能描述**：使用 ANSI 顏色代碼美化終端機輸出
- **顏色配置**：
  - 綠色（`\033[92m`）：A（完全正確）
  - 黃色（`\033[93m`）：B（部分正確）
  - 紅色（`\033[91m`）：錯誤訊息
  - 青色（`\033[96m`）：提示訊息
  - 粗體（`\033[1m`）：強調文字
- **實作類別**：`Colors`

#### F-102：中斷處理
- **功能描述**：妥善處理使用者的中斷操作（Ctrl+C）
- **處理位置**：
  - 猜測輸入時
  - 詢問是否重玩時
- **行為**：顯示友善訊息後優雅退出

---

## 4. 技術架構

### 4.1 系統架構

```
┌─────────────────────────────────────┐
│         Main Entry Point            │
│          main()                     │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│       Game Loop Controller          │
│          play_game()                │
└──────┬──────────────────────────────┘
       │
       ├──► generate_secret_number()   [隨機產生]
       │
       ├──► validate_input()           [輸入驗證]
       │
       ├──► calculate_result()         [結果計算]
       │
       └──► Colors                     [顏色輸出]
```

### 4.2 資料流程

```
使用者輸入
    │
    ▼
輸入驗證 ──X──► 錯誤訊息 ──► 重新輸入
    │ ✓
    ▼
計算 A、B
    │
    ▼
顯示結果
    │
    ├──► 4A0B ──► 遊戲勝利
    └──► 其他 ──► 繼續猜測或遊戲結束
```

### 4.3 檔案結構

```
1A2B_cli/
├── 1a2b.py           # 主程式
├── pyproject.toml    # 專案配置
├── uv.lock           # 依賴鎖定檔
├── README.md         # 使用說明
└── spec.md           # 本規格書
```

---

## 5. 詳細設計

### 5.1 核心函式規格

#### 5.1.1 generate_secret_number()

```python
def generate_secret_number() -> str
```

**功能**：產生一個 4 位不重複的隨機數字

**演算法**：
1. 建立 0-9 的數字列表
2. 隨機打亂順序
3. 取前 4 個數字組成字串

**時間複雜度**：O(1)
**空間複雜度**：O(1)

**回傳值**：長度為 4 的字串，如 "1234"

---

#### 5.1.2 calculate_result(secret, guess)

```python
def calculate_result(secret: str, guess: str) -> tuple[int, int]
```

**功能**：計算猜測結果的 A 和 B 數量

**參數**：
- `secret`：正確答案（長度 4 的字串）
- `guess`：玩家猜測（長度 4 的字串）

**演算法**：
```python
for i in range(4):
    if guess[i] == secret[i]:
        a_count += 1                    # 位置和數字都對
    elif guess[i] in secret:
        b_count += 1                    # 數字對但位置錯
```

**時間複雜度**：O(n)，其中 n=4
**空間複雜度**：O(1)

**回傳值**：`(a_count, b_count)` 元組

**範例**：
```python
calculate_result("1234", "1256")  # 回傳 (2, 1)
# 說明：1、2 位置正確(2A)，5 在答案中但位置錯誤(1B)
```

---

#### 5.1.3 validate_input(guess)

```python
def validate_input(guess: str) -> tuple[bool, str]
```

**功能**：驗證使用者輸入是否符合規則

**參數**：
- `guess`：玩家輸入的字串

**驗證規則**：

| 規則 | 檢查方式 | 錯誤訊息 |
|------|----------|----------|
| 長度為 4 | `len(guess) != 4` | "請輸入 4 位數字！" |
| 只含數字 | `not guess.isdigit()` | "請只輸入數字！" |
| 不可重複 | `len(set(guess)) != 4` | "數字不可重複！" |

**回傳值**：
- 驗證通過：`(True, "")`
- 驗證失敗：`(False, error_msg)`

**測試案例**：

| 輸入 | 預期結果 | 說明 |
|------|----------|------|
| "1234" | (True, "") | 合法輸入 |
| "123" | (False, "請輸入 4 位數字！") | 長度不足 |
| "12a4" | (False, "請只輸入數字！") | 含非數字字元 |
| "1123" | (False, "數字不可重複！") | 數字重複 |

---

#### 5.1.4 play_game()

```python
def play_game() -> bool
```

**功能**：執行一局完整的遊戲

**流程圖**：

```
開始
  │
  ▼
產生隨機答案
  │
  ▼
顯示遊戲規則
  │
  ▼
attempt = 1
  │
  ▼
┌─────────────────────┐
│ 輸入猜測數字        │
│  (輸入驗證迴圈)     │
└──────┬──────────────┘
       │
       ▼
  計算 A、B
       │
       ▼
  顯示結果
       │
       ├──► 4A0B？──Yes──► 顯示勝利訊息 ──► return True
       │       │
       │       No
       │       │
       ▼       ▼
  attempt++   
       │
       ▼
  達到 10 次？──No──┐
       │            │
       Yes          │
       │            │
       ▼            │
顯示失敗訊息       │
       │            │
       ▼            │
  return False ◄────┘
```

**回傳值**：
- `True`：玩家猜對
- `False`：用完機會或中斷遊戲

---

#### 5.1.5 main()

```python
def main() -> None
```

**功能**：程式主入口，控制整體遊戲流程

**流程**：
1. 顯示遊戲標題（含版本號）
2. 執行單局遊戲
3. 詢問是否再玩一次
4. 根據回答決定繼續或結束

**特殊處理**：
- 中文標題居中對齊（考慮中文字元寬度）
- Ctrl+C 中斷處理
- 輸入驗證（只接受 Y/YES/N/NO）

---

### 5.2 使用者介面規格

#### 5.2.1 遊戲標題畫面

```
╔═══════════════════════════════════════════╗
║         1A2B 猜數字遊戲 v1.0               ║
╚═══════════════════════════════════════════╝
```

- 使用 Unicode 方框字元繪製邊框
- 標題內容動態居中對齊
- 使用青色粗體顯示

---

#### 5.2.2 遊戲規則說明

```
==================================================
歡迎來到 1A2B 猜數字遊戲！
==================================================
遊戲規則：
- 電腦已隨機產生 4 個不重複的數字
- A 代表數字和位置都正確
- B 代表數字正確但位置錯誤
- 您最多有 10 次機會
==================================================
```

- A 和 B 使用對應顏色顯示（綠色和黃色）
- 規則簡潔明確

---

#### 5.2.3 猜測輸入與回饋

**正常猜測**：
```
第  1 次猜測: 1234  →  1A2B
第  2 次猜測: 5678  →  0A1B
```

**輸入錯誤**：
```
第  3 次猜測: 123  →  請輸入 4 位數字！
第  3 次猜測: 12a4  →  請只輸入數字！
第  3 次猜測: 1123  →  數字不可重複！
```

**技術細節**：
- 使用 ANSI 跳脫序列 `\033[A` 向上移動游標
- 使用 `\r` 回到行首
- 使用 `\033[K` 清除行尾
- 結果顯示在同一行，避免畫面混亂

---

#### 5.2.4 遊戲結束畫面

**勝利畫面**：
```
==================================================
🎉 恭喜你！您猜對了！答案是 1234
您總共猜了 5 次
==================================================
```

**失敗畫面**：
```
==================================================
😢 很遺憾，您已用完 10 次機會！
正確答案是：1234
==================================================
```

---

#### 5.2.5 重玩確認

```
是否要再玩一次？(Y/N): 
```

- 接受輸入：Y、YES、N、NO（不區分大小寫）
- 其他輸入顯示錯誤訊息並重新詢問

---

## 6. 顏色配置規範

### 6.1 ANSI 顏色代碼定義

| 用途 | 顏色 | ANSI 代碼 | 常數名稱 |
|------|------|-----------|----------|
| A（完全正確） | 綠色 | `\033[92m` | `Colors.GREEN` |
| B（部分正確） | 黃色 | `\033[93m` | `Colors.YELLOW` |
| 錯誤訊息 | 紅色 | `\033[91m` | `Colors.RED` |
| 提示訊息 | 青色 | `\033[96m` | `Colors.CYAN` |
| 強調文字 | 粗體 | `\033[1m` | `Colors.BOLD` |
| 重置顏色 | - | `\033[0m` | `Colors.RESET` |

### 6.2 顏色使用原則

1. **一致性**：相同類型的訊息使用相同顏色
2. **可讀性**：顏色與背景對比度足夠
3. **語意化**：
   - 綠色 = 成功/正確
   - 黃色 = 警告/部分正確
   - 紅色 = 錯誤/失敗
   - 青色 = 資訊/提示

---

## 7. 錯誤處理

### 7.1 輸入錯誤處理

| 錯誤類型 | 檢測方式 | 處理方式 |
|----------|----------|----------|
| 長度錯誤 | `len(guess) != 4` | 顯示錯誤訊息，要求重新輸入 |
| 非數字字元 | `not guess.isdigit()` | 顯示錯誤訊息，要求重新輸入 |
| 數字重複 | `len(set(guess)) != 4` | 顯示錯誤訊息，要求重新輸入 |

### 7.2 中斷處理

| 中斷時機 | 捕捉例外 | 處理方式 |
|----------|----------|----------|
| 猜測輸入時 | `KeyboardInterrupt`, `EOFError` | 顯示「遊戲中斷！」，結束當局 |
| 重玩確認時 | `KeyboardInterrupt`, `EOFError` | 顯示「感謝遊玩！再見！」，退出程式 |

### 7.3 邊界條件

- **最大猜測次數**：10 次（可調整）
- **數字範圍**：0-9（固定）
- **答案長度**：4 位（固定）

---

## 8. 測試案例

### 8.1 功能測試

#### TC-001：正常遊戲流程
- **前置條件**：啟動遊戲
- **測試步驟**：
  1. 輸入合法的 4 位不重複數字
  2. 觀察回饋結果
  3. 根據提示繼續猜測
  4. 猜對後選擇不再玩
- **預期結果**：顯示勝利訊息，遊戲正常結束

#### TC-002：用完 10 次機會
- **前置條件**：啟動遊戲
- **測試步驟**：
  1. 連續輸入 10 次不同的猜測（都不正確）
- **預期結果**：顯示失敗訊息與正確答案

#### TC-003：輸入驗證
- **測試資料**：

| 輸入 | 預期結果 |
|------|----------|
| "123" | 錯誤：請輸入 4 位數字！ |
| "12345" | 錯誤：請輸入 4 位數字！ |
| "12a4" | 錯誤：請只輸入數字！ |
| "1123" | 錯誤：數字不可重複！ |
| "1234" | 接受並計算結果 |

#### TC-004：重玩功能
- **測試步驟**：
  1. 完成一局遊戲
  2. 輸入 "Y" 選擇重玩
  3. 完成第二局
  4. 輸入 "N" 選擇結束
- **預期結果**：能夠正常重玩，結束時顯示感謝訊息

#### TC-005：中斷處理
- **測試步驟**：
  1. 在猜測輸入時按 Ctrl+C
  2. 觀察程式反應
- **預期結果**：顯示「遊戲中斷！」，當局結束但程式不崩潰

### 8.2 結果計算測試

| 答案 | 猜測 | 預期結果 | 說明 |
|------|------|----------|------|
| "1234" | "1234" | 4A0B | 完全正確 |
| "1234" | "4321" | 0A4B | 全部數字對但位置都錯 |
| "1234" | "1256" | 2A1B | 1、2 正確，5 存在但位置錯 |
| "1234" | "5678" | 0A0B | 完全沒有相同數字 |
| "1234" | "1324" | 2A2B | 1、4 正確，2、3 存在但位置錯 |

---

## 9. 效能考量

### 9.1 時間複雜度

| 函式 | 時間複雜度 | 說明 |
|------|------------|------|
| `generate_secret_number()` | O(1) | 固定產生 4 個數字 |
| `calculate_result()` | O(n) | n=4，固定長度 |
| `validate_input()` | O(n) | n=4，固定長度 |
| `play_game()` | O(m) | m≤10，最多 10 次猜測 |

### 9.2 空間複雜度

- 所有函式空間複雜度皆為 O(1)
- 無大量資料儲存需求

### 9.3 效能瓶頸

- **主要瓶頸**：使用者輸入等待時間
- **次要瓶頸**：終端機 I/O
- **優化方向**：目前效能已足夠，無需優化

---

## 10. 部署與執行

### 10.1 安裝步驟

```bash
# 1. 克隆或下載專案
cd 1A2B_cli

# 2. 同步 Python 環境（使用 uv）
uv sync

# 3. 執行遊戲
uv run python 1a2b.py
```

### 10.2 替代執行方式

```bash
# 直接使用系統 Python
python 1a2b.py
```

### 10.3 系統相容性

| 作業系統 | 測試狀態 | 備註 |
|----------|----------|------|
| Windows 10+ | ✅ 支援 | 建議使用 Windows Terminal |
| macOS | ✅ 支援 | 內建 Terminal 即可 |
| Linux | ✅ 支援 | 大部分終端機皆支援 ANSI |

---

## 11. 維護與擴充

### 11.1 已知限制

1. **終端機相依性**：需要支援 ANSI 顏色代碼的終端機
2. **單人遊戲**：目前僅支援單人模式
3. **難度固定**：數字長度和猜測次數固定

### 11.2 未來擴充方向

#### 優先級 P1（高）
- [ ] 新增難度選項（3 位、5 位、6 位數字）
- [ ] 記錄遊戲歷史與統計資料
- [ ] 提供提示功能（消耗猜測次數）

#### 優先級 P2（中）
- [ ] 雙人對戰模式
- [ ] 排行榜系統
- [ ] 自訂顏色配置

#### 優先級 P3（低）
- [ ] 音效支援
- [ ] GUI 版本
- [ ] 多語言支援（英文、日文等）

### 11.3 程式碼維護原則

1. **可讀性優先**：保持程式碼簡潔清晰
2. **函式單一職責**：每個函式只做一件事
3. **適當註解**：關鍵邏輯需有註解說明
4. **一致的命名**：使用有意義的變數名稱
5. **錯誤處理**：妥善處理所有可能的例外情況

---

## 12. 附錄

### 12.1 專案檔案說明

| 檔案名稱 | 說明 | 必要性 |
|----------|------|--------|
| `1a2b.py` | 主程式檔案 | 必要 |
| `pyproject.toml` | 專案配置檔 | 必要 |
| `uv.lock` | 依賴鎖定檔 | 建議 |
| `README.md` | 使用說明文件 | 建議 |
| `spec.md` | 系統規格書（本文件） | 參考 |

### 12.2 相關資源

- **Python 官方文件**：https://docs.python.org/3/
- **uv 文件**：https://docs.astral.sh/uv/
- **1A2B 遊戲規則**：https://zh.wikipedia.org/wiki/猜數字

### 12.3 版本歷史

| 版本 | 日期 | 變更內容 |
|------|------|----------|
| 1.0.0 | 2025-11-27 | 初始版本發布 |

### 12.4 授權資訊

本專案採用 **MIT License** 授權。

---

## 文件結束

**最後審閱日期**：2025-11-27  
**審閱者**：1A2B Development Team  
**文件狀態**：✅ 已核准






